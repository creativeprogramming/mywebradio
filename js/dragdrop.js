dragDrop=new Class({options:{container:null,dropzone:false,dragzone:false,snap:10},initialize:function(c,b,a){this.container=new Element("div");this.dropzone=b;this.dragzone=c;this.container.id=a;$(document.body).adopt(this.container);this.bound={start:this.start.bindWithEvent(this),check:this.check.bindWithEvent(this),drag:this.drag.bindWithEvent(this),stop:this.stop.bindWithEvent(this)};$(this.dragzone).addEvent("mousedown",this.bound.start)},start:function(a){if((this.dragzone=="treemenu")&&(a.target.tagName=="LI")){this.track=a.target}else{if((current_row)&&(current_element==this.dragzone)){this.track=$(current_row)}else{this.track=null}}if(this.track){this.startx=a.client.x;this.starty=a.client.y;this.fired=false;document.addListener("mousemove",this.bound.check);document.addListener("mouseup",this.bound.stop)}a.stop()},check:function(a){var b=Math.abs(this.startx-a.client.x)+Math.abs(this.starty-a.client.y);if(b>this.options.snap){switch(this.dragzone){case"playlist":this.container.innerHTML=this.track.childNodes[1].innerHTML+" - "+this.track.childNodes[2].innerHTML;break;case"treemenu":this.container.innerHTML=this.track.innerHTML;break;default:this.container.innerHTML=this.multiline();break}this.container.style.display="block";document.removeListener("mousemove",this.bound.check);document.addListener("mousemove",this.bound.drag);this.fired=true;this.drag(a)}a.stop()},multiline:function(){this.track.addClass("marked");n=0;opacity=1;dragText="";tracks=$$("#trackTable tbody tr");for(var b=0,a=tracks.length;b<a;b++){if(tracks[b].className.search("marked")!=-1){dragText+="<div style='opacity:"+opacity+"'>"+tracks[b].childNodes[0].innerHTML+" - "+tracks[b].childNodes[1].innerHTML+"</div>";if(n>=3){return dragText+"<div style='opacity:"+opacity+"'>....</div>"}n++;opacity=opacity-0.2}}return dragText},drag:function(a){this.container.setStyles({top:a.client.y-3,left:a.client.x+1});a.stop()},stop:function(c){document.removeListener("mousemove",this.bound.check);document.removeListener("mousemove",this.bound.drag);document.removeListener("mouseup",this.bound.stop);this.container.style.display="none";if(this.fired){el=$(this.dropzone).getCoordinates();if(c.client.x>el.left&&c.client.x<el.right&&c.client.y<el.bottom&&c.client.y>el.top){switch(this.dragzone){case"tracklist":addSelected();break;case"treemenu":controllRemote("addSong",this.track.title,true,"playlist");break;default:if($(current_row)){var b=0;var a=parseInt($(current_row).id.substr(2));$$("#plTable tbody tr").each(function(d){if(d.className.search("marked")!=-1){rowId=parseInt(d.id.substr(2));if(rowId<a){rowId=rowId-b}controllRemote("moveSong",rowId+":"+a,false,"playlist");if(rowId>a){a++}b++}});if(b==0){controllRemote("moveSong",parseInt(this.track.id.substr(2))+":"+a,false,"playlist")}pingTimer=setTimeout("pingMPD()",1000)}}}}}});window.addEvent("domready",function(){var a=new dragDrop("treemenu","playlist","dragContainer");var c=new dragDrop("tracklist","playlist","dragContainer");var b=new dragDrop("playlist","playlist","dragContainer")});